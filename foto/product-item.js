define(["jquery","underscore","Magento_Customer/js/customer-data","jquery/ui","jquery/jquery-storageapi"],function(e,s,t){return e.widget("psa.productItem",{_create:function(){var s=this;s.wishlistBtn=s.element.find(".towishlist"),s.wishlistPopup=s.element.find(".pop-up-box"),s.wishlistBtn.on("click",function(e){s._isUserLoggedIn()&&(e.preventDefault(),e.stopImmediatePropagation(),s._toggleWishList(this))}),e(window).on("close-wishlist",function(){e(".wishlist-container").children().fadeOut(200).filter(".wishlist").remove(),e("body").off("click.snb.wishlist.close")}),s._checkWishListActive()},_toggleWishList:function(i){var a=this,o=!1,r=e(i).data("post"),n=e("input[name=form_key]").val();r.data.form_key=n,window.currentProduct=e(a.element).find(".product-item-link").text().trim();var d=jQuery(a.element).find(".towishlist").attr("id");if(1==jQuery(".wl-"+d).hasClass("wishlisted")){r.action=window.location.origin+"/wishlist/index/remove/";var l=null,c=JSON.parse(localStorage.getItem("mage-cache-storage")).wishlist;s.each(c.items,function(e){e.product_id==r.data.product&&(l=e.wishlist_item_id)}),r.data.item=l,o=!0}else r.action=window.location.origin+"/wishlist/index/add/";var m=e("body");m.trigger("processStart"),e.post(r.action,r.data,function(){a.element.trigger("processStop").addClass("added-to-wishlist").find(".towishlist"),1==o?a.element.removeClass("added-to-wishlist").find(".towishlist").removeClass("wishlisted"):a.element.find(".towishlist").addClass("wishlisted"),m.trigger("processStop"),e.initNamespaceStorage("mage-cache-storage").localStorage.remove("messages"),e.cookieStorage.set("mage-messages",""),t.set("messages",{messages:""});var i=window.currentProduct,r="";if(o){r='<div class="message-success success message show"> '+i+e.mage.__(" has been deleted from your Wish List.")+"</div>"}else{r='<div class="message-success success message show"> '+i+e.mage.__(" has been added to your Wish List.")+"</div>"}e(".link.wishlist a").removeClass("empty"),e(".page.messages").html(r),window.currentProduct=void 0;var n=e.cookieStorage.get("mage-messages");s.isEmpty(n)||(t.set("messages",{}),e.cookieStorage.set("mage-messages",""));var d=["messages","wishlist"];t.invalidate(d),t.reload(d,!0)})},_isUserLoggedIn:function(){var e=t.get("customer");return s.isString(e().firstname)},_checkWishListActive:function(){var e=this,i=JSON.parse(localStorage.getItem("mage-cache-storage")).kemana_wishlist,a=e.element.find(".towishlist").attr("id");!s.isEmpty(i)&&s.isArray(i.items)&&i.items.length&&s.each(i.items,function(s){if(s===a){e.element.addClass("added-to-wishlist");document.getElementById(s).classList.add("wishlisted")}}),t.set("messages",{messages:""})}}),e.psa.productItem});
//# sourceMappingURL=product-item.js.map